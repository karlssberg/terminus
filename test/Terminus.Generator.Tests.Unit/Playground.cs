// <auto-generated/> Generated by Terminus EntryPointDiscoveryGenerator
#nullable enable
using Microsoft.Extensions.DependencyInjection;
using System;
using System.Reflection;
using Terminus;
using Terminus.Attributes;
using Terminus.Strategies;

using Terminus.Attributes;
using System;

namespace Demo
{
    [AutoGenerate]
    public partial interface IMediator;
                
    public static class TestEntryPoints
    {
        [EntryPoint]
        public static void Hello(string world) 
        { 
            Console.WriteLine($"hello {world}"); 
        }
    }
}

namespace Demo
{
    public partial interface IMediator
    {
        void Hello(string world);
    }

    internal sealed class IMediator_Generated : Demo.IMediator
    {
        private readonly IServiceProvider _serviceProvider;
        private readonly ParameterBindingStrategyResolver _resolver;
        public IMediator_Generated(IServiceProvider serviceProvider, ParameterBindingStrategyResolver resolver)
        {
            _serviceProvider = serviceProvider;
            _resolver = resolver;
        }

        public void Hello(string world)
        {
            using (var scope = _serviceProvider.CreateScope())
            {
                Demo.TestEntryPoints.Hello(world);
            }
        }
    }
}

namespace Terminus.Generated
{
    public static partial class ServiceCollectionExtensions
    {
        private static IServiceCollection AddEntryPointsFor_Terminus_Attributes_EntryPointAttribute(this IServiceCollection services, Action<ParameterBindingStrategyResolver>? configure = null)
        {
            var resolver = new ParameterBindingStrategyResolver();
            configure?.Invoke(resolver);
            services.AddSingleton(resolver);
            services.AddTransient<IDispatcher<Terminus.Attributes.EntryPointAttribute>, ScopedDispatcher<Terminus.Attributes.EntryPointAttribute>>();
            services.AddTransient<IAsyncDispatcher<Terminus.Attributes.EntryPointAttribute>, ScopedDispatcher<Terminus.Attributes.EntryPointAttribute>>();
            services.AddTransient<IEntryPointRouter<Terminus.Attributes.EntryPointAttribute>, DefaultEntryPointRouter<Terminus.Attributes.EntryPointAttribute>>();
            services.AddSingleton<EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>>(new EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>(typeof(Demo.TestEntryPoints).GetMethod("Hello", new System.Type[] { typeof(string) })!, (context, ct) => Demo.TestEntryPoints.Hello(resolver.ResolveParameter<string>("world", context))));
            services.AddSingleton<Demo.IMediator, Demo.IMediator_Generated>();
            return services;
        }
    }
}

namespace Terminus.Generated
{
    public static partial class ServiceCollectionExtensions
    {
        public static IServiceCollection AddEntryPoints<T>(this IServiceCollection services, Action<ParameterBindingStrategyResolver>? configure = null)
            where T : EntryPointAttribute
        {
            switch (typeof(T).FullName)
            {
                case "Terminus.Attributes.EntryPointAttribute":
                    return services.AddEntryPointsFor_Terminus_Attributes_EntryPointAttribute(configure);
            };
            throw new InvalidOperationException($"No entry point discovery strategy found for type '{typeof(T).FullName}'");
        }

        public static IServiceCollection AddEntryPoints(this IServiceCollection services, Action<ParameterBindingStrategyResolver>? configure = null)
        {
            services.AddEntryPointsFor_Terminus_Attributes_EntryPointAttribute();
            return services;
        }
    }
}