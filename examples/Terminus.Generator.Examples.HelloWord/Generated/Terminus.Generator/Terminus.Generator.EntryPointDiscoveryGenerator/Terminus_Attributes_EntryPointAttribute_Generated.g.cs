// <auto-generated/> Generated by Terminus EntryPointDiscoveryGenerator
#nullable enable
using Microsoft.Extensions.DependencyInjection;
using System;
using System.Reflection;
using Terminus;
using Terminus.Attributes;
using Terminus.Strategies;

namespace Terminus.Generator.Examples.HelloWorld
{
    public partial interface IMyListener
    {
        void Handle(string message);
        System.Threading.Tasks.Task<string> Query(string message1, string message2, System.Threading.CancellationToken cancellationToken);
    }

    internal sealed class IMyListener_Generated : Terminus.Generator.Examples.HelloWorld.IMyListener
    {
        private readonly IServiceProvider _serviceProvider;
        private readonly ParameterBindingStrategyResolver _resolver;
        public IMyListener_Generated(IServiceProvider serviceProvider, ParameterBindingStrategyResolver resolver)
        {
            _serviceProvider = serviceProvider;
            _resolver = resolver;
        }

        public void Handle(string message)
        {
            using (var scope = _serviceProvider.CreateScope())
            {
                scope.ServiceProvider.GetRequiredService<Terminus.Generator.Examples.HelloWorld.MyListener>().Handle(message);
            }
        }

        public System.Threading.Tasks.Task<string> Query(string message1, string message2, System.Threading.CancellationToken cancellationToken)
        {
            using (var scope = _serviceProvider.CreateScope())
            {
                return Terminus.Generator.Examples.HelloWorld.MyListener.Query(message1, message2, cancellationToken);
            }
        }
    }
}

namespace Terminus.Generated
{
    public static partial class ServiceCollectionExtensions
    {
        private static IServiceCollection AddEntryPointsFor_Terminus_Attributes_EntryPointAttribute(this IServiceCollection services, Action<ParameterBindingStrategyResolver>? configure = null)
        {
            var resolver = new ParameterBindingStrategyResolver();
            configure?.Invoke(resolver);
            services.AddSingleton(resolver);
            services.AddTransient<IDispatcher<Terminus.Attributes.EntryPointAttribute>, ScopedDispatcher<Terminus.Attributes.EntryPointAttribute>>();
            services.AddTransient<IAsyncDispatcher<Terminus.Attributes.EntryPointAttribute>, ScopedDispatcher<Terminus.Attributes.EntryPointAttribute>>();
            services.AddTransient<IEntryPointRouter<Terminus.Attributes.EntryPointAttribute>, DefaultEntryPointRouter<Terminus.Attributes.EntryPointAttribute>>();
            services.AddSingleton<EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>>(new EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>(typeof(Terminus.Generator.Examples.HelloWorld.MyListener).GetMethod("Handle", new System.Type[] { typeof(string) })!, (context, ct) => context.ServiceProvider.GetRequiredService<Terminus.Generator.Examples.HelloWorld.MyListener>().Handle(resolver.ResolveParameter<string>("message", context))));
            services.AddSingleton<EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>>(new EntryPointDescriptor<Terminus.Attributes.EntryPointAttribute>(typeof(Terminus.Generator.Examples.HelloWorld.MyListener).GetMethod("Query", new System.Type[] { typeof(string), typeof(string), typeof(System.Threading.CancellationToken) })!, (context, ct) => Terminus.Generator.Examples.HelloWorld.MyListener.Query(resolver.ResolveParameter<string>("message1", context), resolver.ResolveParameter<string>("message2", context), ct)));
            services.AddTransient<Terminus.Generator.Examples.HelloWorld.MyListener>();
            services.AddTransient<Terminus.Generator.Examples.HelloWorld.MyListener>();
            services.AddSingleton<Terminus.Generator.Examples.HelloWorld.IMyListener, Terminus.Generator.Examples.HelloWorld.IMyListener_Generated>();
            return services;
        }
    }
}